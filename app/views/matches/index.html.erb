<div class="container">
  <div style="width: 100%; height: 600px;"
    data-controller="mapbox"
    data-mapbox-markers-value="<%= @markers.to_json %>"
    data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
  <% @matches.each_with_index do |match, ind| %>
      <% participations = match.participations %>
      <% userparticipants = [] %>
      <% participations.each do |participation| %>
        <% userparticipants << participation.user %>
      <% end %>
      <div class="card-match" data-matchId="<%= ind %>">
        <div class="match-info">
          <%= cl_image_tag match.user.photo.key, class: "match-avatar" %>
          <div class="match">
              <h2><%= match.user.user_name %></h2>
              <p>📅 <%= match.date.strftime("%d.%m.%y") %><p>
              <p>🕒 <%= match.start_time.time.to_s(:time) %> - <%= match.end_time.time.to_s(:time) %><p>
              <p>📍 <%= match.venue.address %><p>
          </div>
        </div>
      </div>
      <div class="match-modal" id="match-modal-<%= ind %>">
        <div class="match-modal-content animate-bottom">
          <%= cl_image_tag match.user.photo.key, class: "match-avatar" %>
          <p>🏓 <%= match.user.user_name %> is the host</p>
          <p>📅 <%= match.date.strftime("%d.%m.%y") %><p>
          <p>🕒 <%= match.start_time.time.to_s(:time) %> - <%= match.end_time.time.to_s(:time)%> </p>
          <p>📍 <%= match.venue.address %><p>
          <p>👨‍👩‍👧‍👧 <%= match.capacity %> / <%= userparticipants.length %> <%=match.capacity - userparticipants.length%> <%= "player".pluralize(match.capacity - userparticipants.length)%> can join</p>
          <p>💬 <%= match.comment %><p>
          <p><div class="btn btn-cta"><%=link_to "Ask to Play", match_path(match) %></div></p>
          <span class="match-modal-close" id="match-modal-close-<%= ind %>">&times;</span>
          <br>
        </div>
      </div>
  <% end %>
  <p><div class="btn btn-cta"><%= link_to "Create a new match", new_match_path %></div>
</div>

<%# test %>
